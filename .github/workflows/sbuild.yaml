# SPDX-FileCopyrightText: 2025 geisserml <geisserml@gmail.com>
# SPDX-License-Identifier: Apache-2.0 OR BSD-3-Clause

name: Sourcebuild

on:
  workflow_dispatch:
    inputs:
      linux:
        type: boolean
        default: true
      macos:
        type: boolean
        default: true
      windows:
        type: boolean
        default: true
      py_version:
        type: string
        default: '3.12'
      glibc_tag:
        type: string
        default: 'manylinux_2_17'

defaults:
  run:
    shell: bash

jobs:
  
  linux_x64:
    if: ${{ inputs.linux }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: ubuntu-latest
      # actually not cross, but need to set custom tag
      cross_tag: ${{ inputs.glibc_tag }}_x86_64
      py_version: ${{ inputs.py_version }}
  
  linux_x86:
    if: ${{ inputs.linux }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: ubuntu-latest
      params: '--target-cpu x86'
      cross_tag: ${{ inputs.glibc_tag }}_i686
      py_version: ${{ inputs.py_version }}
  
  linux_arm64:
    if: ${{ inputs.linux }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: ubuntu-latest
      params: '--target-cpu arm64'
      cross_tag: ${{ inputs.glibc_tag }}_aarch64
      py_version: ${{ inputs.py_version }}
  
  linux_armv7l:
    if: ${{ inputs.linux }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: ubuntu-latest
      params: '--target-cpu arm'
      cross_tag: ${{ inputs.glibc_tag }}_armv7l
      py_version: ${{ inputs.py_version }}
    
  macos_x64:
    if: ${{ inputs.macos }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: macos-latest  # arm64 host
      params: '--target-cpu x64'
      cross_tag: macosx_11_0_x86_64
      py_version: ${{ inputs.py_version }}
  
  macos_arm64:
    if: ${{ inputs.macos }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: macos-latest
      # actually not cross, but need to set custom tag
      cross_tag: macosx_11_0_arm64
      py_version: ${{ inputs.py_version }}
  
  windows_x64:
    if: ${{ inputs.windows }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: windows-latest
      py_version: ${{ inputs.py_version }}
  
  windows_arm64:
    if: ${{ inputs.windows }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: windows-latest
      params: '--target-cpu arm64'
      cross_tag: win_arm64
      py_version: ${{ inputs.py_version }}
  
  windows_x86:
    if: ${{ inputs.windows }}
    uses: ./.github/workflows/sbuild-one.yaml
    with:
      os: windows-latest
      params: '--target-cpu x86'
      cross_tag: win32
      py_version: ${{ inputs.py_version }}
  
  # TODO android?
